<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="mappers.gsh-movie-mapper">

<!-- 	private String movie_code; 영화코드 -->
<!-- 	private String movie_name; 영화제목 -->
<!-- 	private String movie_genre; 영화장르 -->
<!-- 	private String movie_director; 영화감독 -->
<!-- 	private String movie_actor; 영화배우 -->
<!-- 	private Timestamp movie_open_date; 상영날짜 -->
<!-- 	private int movie_total_time; 상영시간 -->
<!-- 	private String movie_main_image; 이미지 -->
<!-- 	private Timestamp movie_regist_date; 등록날짜 -->
<!-- 	private String movie_grade; 영화등급 -->
<!-- 	private String movie_preview; 영화 예고편 -->

	<!-- 전체 영화 목록 가져오기 -->
	<select id="select_movieAll" resultType="GshMovieDto">
		select * from tbl_movie
		order by movie_code desc
	</select>

	<!-- 영화이름으로 영화 찾기 -->
	<select id="select_movie_name">
		select * from tbl_movie
		where movie_name = #{movie_name}
	</select>
	
	<!-- 장르로 영화 찾기 -->
	<select id="select_movie_genre">
		select * from tbl_movie
		where movie_genre = #{movie_genre}
	</select>
	
	<!-- 영화감독 이름으로 영화 찾기 -->
	<select id="select_movie_director">
		select * from tbl_movie
		where movie_director = #{movie_director}
	</select>
	
	<!-- 영화배우 이름으로 영화 찾기 -->
	<select id="select_movie_actor">
		select * from tbl_movie
		where movie_actor = #{movie_actor}
	</select>
	
	<!-- 영화등급으로 영화 찾기 -->
	<select id="select_movie_grade">
		select * from tbl_movie
		where movie_grade = #{movie_grade}
	</select>

	
	<!--  영화 코드로 영화정보 찾기 -->
	<select id="select_movie_code" resultType="GshMovieDto">
<!-- 		select * from tbl_movie -->
<!-- 		where movie_code = #{movie_code} -->

			select * from
			    (select * from tbl_movie
			     where movie_code = #{movie_code}),
			    (select round(avg(review_score)) review_score from tbl_review
			     where movie_code = #{movie_code})
	</select>
	
	<!-- 영화 내용 가져오기 -->
	<select id="select_movie_content" resultType="GshMovieDto">
		select m.movie_code, m.movie_name, m.movie_genre, m.movie_director, m.movie_actor, m.movie_grade, m.movie_main_image, m.movie_content, r.review_content,  r.review_score
		from tbl_movie m , tbl_review r
		where m.movie_code = #{movie_code}
		and m.movie_code = r.movie_code
	</select>
	
	<!-- 영화 서브 이미지(스틸컷) 가져오기 -->
	<select id="select_movie_sub_iamage" resultType="string">
		select movie_sub_image from tbl_movie_image
		where movie_code = #{movie_code}
	</select>
	
</mapper>